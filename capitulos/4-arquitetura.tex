\chapter{Arquitetura para compartilhamento de informações do ativo}


\section{Estrutura do AAS e seus submodelos}

	O conceito de Memória Digital do Produto (MDP) é inserido dentro da Indústria 4.0 com o objetivo de se agregar valor por meio da possibilidade de acesso a informações sobre o ativo entre parceiros ao longo da cadeia de valor de um ativo.
	
	A MDP na I4.0 é definida como qualquer dado digitalizado que se relacione ao ativo. A MDP é um banco de dados que armazena informações referentes a cada um dos submodelos em um AAS. Cada submodelo agrega informações semelhantes relativas ao ativo. A MDP está localizada no corpo do AAS (\textit{body}).
	
	Os submodelos são divididos em duas categorias, a parte pública e a parte restrita.
	
	Os submodelos públicos contêm informações não confidenciais sobre o ativo e têm funções de identificação na rede. Os submodelos públicos ``Identificação'' e ``Referências'' serão tratados neste trabalho. Estes submodelos têm a função de identificação a si mesmo e criação de \textit{links} com referências para os demais submodelos restritos no AAS e estão localizados no cabeçalho do AAS (\textit{header}).
	
	Os submodelos restritos, por sua vez, contêm informações sensíveis sobre o ativo, que podem ser acessadas mediante autenticação, estes submodelos representam a carga útil do AAS, pois é a porção de informação que é de fato relevante para o cliente que consumirá as informações do AAS. Os submodelos restritos serão mencionados nesse trabalho simplesmente como ``Submodelos''.
	
	A estrutura proposta de um AAS é apresentada na Figura \ref{fig:submodelos-publicos-e-restritos}.
	
	\begin{figure}[H]
		\centering
		\caption{Submodelos públicos e restritos de um AAS.}
		\includegraphics[width=0.7\textwidth]{submodelos-publicos-e-restritos.png}
		\label{fig:submodelos-publicos-e-restritos}
		\source{O autor.}
	\end{figure}

	As informações geradas pelos submodelos são armazenadas na MDP por meio de uma API REST. O acesso à MDP referente a cada submodelo restrito é feito mediante autenticação.
	
	A Tabela \ref{tab:submodelos-publicos-restritos} detalha os tipos de submodelos.
	
	
		\begin{table}[H]
		\centering
		\caption{Caracterização dos submodelos públicos e restritos.}
		\begin{tabular}{|p{1.3in}|p{4in}|}
			
			\hline
			\textbf{Submodelo}
			&\textbf{Descrição} \\
			
			\hline
			Submodelo público
			& Tem a função identificação do ativo na rede. Contém informações que podem ser acessadas sem a necessidade de autenticação, como, por exemplo, seu identificador único universal (UUID - Universal Unique IDentifier), o modelo e fabricante do ativo. O submodelo não tem a função de fornecer uma ficha técnica detalhada, mas apenas uma caracterização abstrata do ativo. Dependendo da confidencialidade do ativo, o submodelo de identificação pode apenas apresentar o UUID como informação pública. Sem o UUID, o AAS se torna inacessível para qualquer uma das partes da cadeia de suprimentos. \\
			
			\hline
			Submodelo restrito
			& Representa a carga útil do AAS (\textit{payload}). Os submodelos restritos contêm as propriedades, funcões e demais regras de negócio do ativo. Os dados dos submodelos são armazenadas na MDP, que podem ser acessada mediante autenticação. Os dados contidos na MDP dos submodelos restritos quando processados fornecem informações sobre o ativo e agregam valor ao mesmo. Além disso, novos modelos de negócio surgem sob os dados gerados pelo ativo. Alguns exemplos de submodelos restritos incluem: a ficha técnica detalhada do ativo, submodelos de histórico de leitura de sensores, histórico de geolocalização do ativo, histórico de padrão de uso, etc.\\
			
		
			\hline
			
		\end{tabular}
		\label{tab:submodelos-publicos-restritos}
		\source{O autor.}
	\end{table}
	
\section{O repositório e a descoberta de AAS's}
	
	Os submodelos \textbf{Identificação} e \textbf{Referências} são a forma primária para a identificação e acesso a um AAS, pois estes submodelos possuem o UUID do AAS e as referências para o acesso dos demais submodelos do AAS.
	
	Para que um AAS seja acessível pelas demais partes da cadeia de suprimentos, os submodelos Identificação e Referências devem estar disponíveis em uma lista pública que contém o submodelo de identificação de todos os AAS disponíveis, esta lista pública é definida como Repositório.
	
	O repositório, além de uma cópia do submodelo de identificação de cada AAS, possui também uma cópia das referências para os demais submodelos de cada AAS, conforme ilustrado na Figura \ref{fig:repositorio}.
	
	
	\begin{figure}[H]
		\centering
		\caption{Repositório com referências aos AAS's.}
		\includegraphics[width=1\textwidth]{repositorio.png}
		\label{fig:repositorio}
		\source{O autor.}
	\end{figure}
	
	O repositório sob contexto da I4.0 é um \textit{web service}, ou seja, um serviço oferecido de um dispositivo eletrônico para outro dispositivo eletrônico com a comunicação entre eles por meio da \textit{World Wide Web} (Internet).
	
	Um \textit{web service} é disponibilizado por meio de um servidor que roda o serviço, escutando e respondendo solicitações de clientes através de uma determinada porta ou rede. Os clientes, por sua vez, consomem o serviço disponibilizado pelo servidor por meio de solicitações.
	
	Para o fornecimento e consumo de \textit{web services} entre cliente e servidor, diversos protocolos de comunicação podem ser utilizados na camada de aplicação do modelo padrão TCP/IP. O protocolo de comunicação para a adoção REST mais difundido na atualidade é o HTTP \cite{gruner2016restful}, porém alguns outros ainda operam, como o MQTT, que está presente principalmente na área de automação residencial e IoT \cite{yokotani2016mqtt}.
	
	
\section{Os quatro elos no compartilhamento de informações na CS}
	
	O modelo estrutural proposto envolve quatro componentes básicos: o AAS, a MDP, o repositório e o cliente. A Figura \ref{fig:4-elos} mostra as conexões entre os quatro elos, onde cada seta representa o fluxo de informações direcional. A interrelação entre as partes envolvendo o servidor REST é detalhada no Capítulo \ref{comunicacao-CS}.
	
	\begin{figure}[H]
		\centering
		\caption{Repositório com referências aos AAS's.}
		\includegraphics[width=0.8\textwidth]{4-elos.png}
		\label{fig:4-elos}
		\source{O autor.}
	\end{figure}
	
	A MDP é representada neste modelo fora do AAS exclusivamente por fins didáticos. A MDP é parte do AAS. A MDP, entretanto, não estará necessariamente armazenada no escopo físico da empresa, mas oferecida em uma plataforma de serviços de computação em nuvem mais adequada para o armazenamento de grandes quantidades de dados, assim como para uma alta capacidade de requisições.
	
	Os elos necessários para o modelo estrutural de acesso a informações pelas partes da cadeia de suprimentos são detalhados na Tabela \ref{tab:4-elos}.
	
	\begin{table}[H]
		\centering
		\caption{Os quatro elos do modelo estrutural de acesso de informações.}
		\label{tab:4-elos}

			\begin{tabular}{lp{12cm}}
				\hline
				\rowcolor[HTML]{F0F0F0} 
				{\color[HTML]{000000} \textbf{Componente}} 
				& {\color[HTML]{000000} \textbf{Descrição}} \\ \hline
				\rowcolor[HTML]{FFFFFF} 
				{\color[HTML]{000000} AAS}         
				& {\color[HTML]{000000} O AAS é a conexão direta com o ativo, o AAS extrai e disponibiliza informações sobre o ativo. Cada submodelo do AAS representa um conjunto de informações semelhantes e suas respectivas funções de agregação.} \\
				\rowcolor[HTML]{F7F7F7} 
				{\color[HTML]{000000} Cliente}     
				& {\color[HTML]{000000} O cliente é a parte que irá consumir as informações disponibilizadas pelo AAS. O cliente representa cada uma das partes da cadeia de suprimentos, ou seja, o fabricante, o distribuidor, o consumidor, etc. }  \\
				\rowcolor[HTML]{FFFFFF} 
				{\color[HTML]{000000} Repositório}
				& {\color[HTML]{000000} O repositório é o \textit{web service} RESTful que faz a interface entre a MDP e o Cliente, ou entre a MDP e o AAS. O cliente solicita ao repositório operações de consulta ao MDP (Método GET), enquanto que o AAS solicita ao repositório operações de inserção de dados ao MDP (Método POST)}        \\
				\rowcolor[HTML]{F7F7F7} 
				{\color[HTML]{000000} MDP}
				& {\color[HTML]{000000} A memória digital do produto é o banco de dados que armazena todas as informações históricas relativas aos submodelos do AAS. A MDP não precisa necessariamente ser um banco de dados único, mas pode ser distribuído conforme a necessidade e tipo de dados a se armazenar.}       
			\end{tabular}%

	\source{O autor.}
	\end{table}
	
	
	
	
	
\section{Estrutura de dados da MDP}

	Segundo \citeonline{radack2009exchangedata}, a série IEC 61360 fornece uma estrutura e um modelo de informação de dicionários sobre produtos. O conceito de tipo de produto é representado por ``classes'' e as características do produto são representadas por ``propriedades''.

	Tais propriedades são elementos de dados padronizados. As definições de tais propriedades podem ser encontradas em vários repositórios, como IEC CDD (dicionário de dados comuns) ou eCl@ss.
	
	A definição de uma propriedade associa um identificador exclusivo mundial a uma definição, que é um conjunto de atributos bem definidos. Atributos relevantes para o AAS são, entre outros, seu nome, o símbolo, a unidade de medida e uma definição textual legível para humanos da propriedade \cite{bader2019aas}.
	
	A publicação sugere formatos de transferência e armazenamento de dados. É especificado o UML (modelo neutro) e esquemas em XML e JSON, assim como mapeamentos para OPC UA, AutomationML e o \textit{Resource Description Framework} (RDF) \cite{plattform2019detailsaas}.
	
	A estrutura proposta usa o padrão de troca de dados JSON, que utiliza texto legível a humanos, no formato atributo-valor (natureza auto-descritiva). O um modelo de transmissão de informações no formato JSON é muito usado em \textit{web services} que usa transferência de estado representacional (REST) e aplicações AJAX, substituindo o uso do XML.
	
	A estrutura de armazenamento proposta usa banco de dados orientado a documentos que usa document em formato JSON com esquemas pré-definidos.
	
	A Figura \ref{fig:json} mostra um exemplo de estruturação de dados para troca e armazenamento de informações em JSON.
	
	\begin{figure}[H]
		\centering
		\caption{Formato de intercâmbio de informações da MDP em JSON.}
		\includegraphics[width=0.8\textwidth]{json.png}
		\label{fig:json}
		\source{O autor.}
  \end{figure}
  

  \section{Acesso à MDP pelo AAS e Cliente}
	\label{comunicacao-CS}
	
	O acesso à MDP pelo AAS a fins de escrita e pelo Cliente a fins de leitura é realizado por meio de uma API REST. No contexto na I4.0, esta API Rest é denominada ``Repositório'' e funciona como uma interface para acesso às funcionalidades do banco de dados da MDP, tais como operações CRUD (criação, leitura, atualização e exclusão).
	
	Além das operações de manipulação da MDP, o repositório serve como uma plataforma de descoberta de AAS's disponíveis, uma vez que ele contém os UUIDs de todos os AAS cadastrados.
	
	
	\subsection{A comunicação AAS - MDP}
	
	A comunicação entre o AAS e a MDP pode ser dividida em cinco etapas:
	
	\begin{enumerate}
		\item O AAS envia ao repositório uma solicitação de inserção de dados sobre o ativo.
		\item O repositório recebe a solicitação de inserção, valida os dados, checa autenticação e envia uma soliciação de inserção de dados à MDP.
		\item A MDP processa as informações e insere em sua estrutura os novos dados.
		\item A MDP retorna uma confirmação de inserção dos dados ao repositório.
		\item O Repositório retorna ao AAS o \textit{status} da solicitação inserção de dados conforme convenções do protocolo HTTP.
	\end{enumerate}
	
	
	A comunicação AAS-MDP é ilustrada na Figura \ref{fig:aas-mdp}.
	
	
	\begin{figure}[H]
		\centering
		\caption{Comunicação AAS-MDP.}
		\includegraphics[width=0.8\textwidth]{aas-mdp.png}
		\label{fig:aas-mdp}
		\source{O autor.}
	\end{figure}

	
	\subsection{A comunicação Cliente - MDP}
	
	A comunicação entre o Cliente e a MDP, assim como a comunicação AAS-MDP, pode ser dividida em cinco etapas semelhantes:
	
	\begin{enumerate}
		\item O Cliente membro da cadeia de suprimento envia ao repositório uma solicitação de consulta de dados sobre o ativo.
		\item O repositório recebe a solicitação de consulta, checa autenticações necessárias e envia uma soliciação de consulta à MDP.
		\item A MDP processa as informações solicitadas através de uma consulta do tipo SELECT.
		\item A MDP retorna os dados solicitados ao repositório com uma confirmação de consulta executada com sucesso.
		\item O Repositório retorna ao Cliente os dados solicitados juntamento com o \textit{status} da solicitação de consulta conforme convenções do protocolo HTTP.
	\end{enumerate}
	
	
	A comunicação Cliente-MDP é ilustrada na Figura \ref{fig:cliente-mdp}.
	
	\begin{figure}[H]
		\centering
		\caption{Comunicação Cliente-MDP.}
		\includegraphics[width=0.8\textwidth]{cliente-mdp.png}
		\label{fig:cliente-mdp}
		\source{O autor.}
	\end{figure}
	
	
	\subsection{Interação AAS-MDP-Cliente}
	
	A interação AAS-MDP-Cliente é basicamente uma operação simultânea assíncrona da comunicação AAS-MDP e a comunicação Cliente-MDP.
	
	Nesta interação, diversos AAS's e diversos clientes podem fazer solicitações independentes ao repositório de operações CRUD.
	
	A Figura \ref{fig:aas-mdp-cliente} ilustra interações simultâneas entre o cliente ou o AAS com o repositório para solicitações de leitura e solicitações de escrita na MDP, respectivamente.
	
	\begin{figure}[H]
		\centering
		\caption{Comunicação Cliente-MDP.}
		\includegraphics[width=1\textwidth]{aas-mdp-cliente.png}
		\label{fig:aas-mdp-cliente}
		\source{O autor.}
	\end{figure}

	Cada AAS não precisa necessariamente estabelecer conexão com apenas uma MDP, diferentes submodelos de uma AAS podem ter seus dados salvos em diferentes serviços de armazenamento em nuvem, ou até mesmo em um banco de dados local na própria empresa.
	
	Cada cliente deve se autenticar junto ao repositório a fim de ser consultar a MDP. Isto significa que cada cliente não tem o acesso integral a todos os submodelos do AAS, mas somente àquele que for determinado por projeto.
	
	Na Figura \ref{fig:aas-mdp-cliente} são exemplificados três tipos de clientes com seus respectivos escopos de autenticação. O Cliente 1 pode acessar somente informações relativas ao submodelo de leitura de sensores de temperatura e pressão, o Cliente 2 pode acessar somente informações sobre o submodelo de geolocalização, o Cliente 3 acessa somente o submodelo de ficha técnica e manuais.
	
	
	
	\section{O MDP e as Camadas do RAMI4.0}

	Segundo \citeonline{iec2017rami}, o RAMI4.0 fornece uma visão estruturada dos principais elementos de um ativo, usando um modelo de níveis composto por três eixos. Desta forma, interrelações complexas podem ser divididas em seções menores e mais gerenciáveis, combinando os três eixos em cada ponto da vida do ativo para representar cada aspecto relevante.
	
	Desta forma, a coparticipação da MDP deve ser representada também conforme a estrutura do RAMI4.0, explicitando em que parte acontece cada interação entre AAS, MDP, Repositório e Cliente.
	
	
	Desenvolvendo....